<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Batalha Jokenp√¥</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            touch-action: none;
        }

        #gameCanvas {
            display: block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            touch-action: none;
        }

        .dark #gameCanvas {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }

        .emoji-button {
            font-size: 3rem;
            transition: all 0.3s ease;
            filter: grayscale(30%);
        }

        .emoji-button:hover, .emoji-button:active {
            transform: scale(1.2);
            filter: grayscale(0%);
        }

        .emoji-button.selected {
            transform: scale(1.3);
            filter: grayscale(0%) drop-shadow(0 0 20px rgba(93, 92, 222, 0.8));
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .pulse-animation {
            animation: pulse 1s infinite;
        }

        .result-banner {
            animation: slideDown 0.5s ease-out;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
    </style>
</head>
<body class="bg-gray-900">
    <!-- Tela de Sele√ß√£o -->
    <div id="selectionScreen" class="fixed inset-0 flex flex-col items-center justify-center bg-gradient-to-br from-purple-600 to-indigo-800 dark:from-gray-900 dark:to-gray-800 z-50">
        <h1 class="text-4xl md:text-6xl font-bold text-white mb-4 text-center px-4">Batalha Jokenp√¥</h1>
        <p class="text-xl md:text-2xl text-white mb-12 text-center px-4">Escolha sua aposta:</p>

        <div class="flex gap-8 md:gap-12 mb-12">
            <button onclick="selectBet('rock')" class="emoji-button bg-white dark:bg-gray-700 rounded-full p-6 md:p-8 shadow-2xl hover:shadow-purple-500/50" id="btn-rock">
                ü™®
            </button>
            <button onclick="selectBet('paper')" class="emoji-button bg-white dark:bg-gray-700 rounded-full p-6 md:p-8 shadow-2xl hover:shadow-purple-500/50" id="btn-paper">
                üìÉ
            </button>
            <button onclick="selectBet('scissors')" class="emoji-button bg-white dark:bg-gray-700 rounded-full p-6 md:p-8 shadow-2xl hover:shadow-purple-500/50" id="btn-scissors">
                ‚úÇÔ∏è
            </button>
        </div>

        <button onclick="startGame()" id="startBtn" class="bg-purple-500 hover:bg-purple-600 text-white text-xl md:text-2xl px-12 py-4 rounded-full font-bold shadow-2xl disabled:opacity-50 disabled:cursor-not-allowed transition-all" disabled>
            Iniciar Batalha
        </button>

        <div class="mt-8 text-white text-center px-4">
            <p class="text-lg md:text-xl mb-2">üìÉ Papel vence ü™® Pedra</p>
            <p class="text-lg md:text-xl mb-2">ü™® Pedra vence ‚úÇÔ∏è Tesoura</p>
            <p class="text-lg md:text-xl">‚úÇÔ∏è Tesoura vence üìÉ Papel</p>
        </div>
    </div>

    <!-- Canvas do Jogo -->
    <canvas id="gameCanvas"></canvas>

    <!-- Placar -->
    <div id="scoreboard" class="fixed top-4 left-0 right-0 flex justify-around px-4 z-40" style="display: none;">
        <div class="bg-white/90 dark:bg-gray-800/90 rounded-lg px-4 py-2 shadow-lg">
            <div class="text-2xl md:text-3xl">ü™® <span id="rockCount" class="font-bold">0</span></div>
        </div>
        <div class="bg-white/90 dark:bg-gray-800/90 rounded-lg px-4 py-2 shadow-lg">
            <div class="text-2xl md:text-3xl">üìÉ <span id="paperCount" class="font-bold">0</span></div>
        </div>
        <div class="bg-white/90 dark:bg-gray-800/90 rounded-lg px-4 py-2 shadow-lg">
            <div class="text-2xl md:text-3xl">‚úÇÔ∏è <span id="scissorsCount" class="font-bold">0</span></div>
        </div>
    </div>

    <!-- Banner de Resultado -->
    <div id="resultBanner" class="fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white dark:bg-gray-800 rounded-2xl p-8 shadow-2xl z-50 text-center" style="display: none;">
        <h2 class="text-3xl md:text-5xl font-bold mb-4" id="resultTitle"></h2>
        <p class="text-xl md:text-2xl mb-6" id="resultText"></p>
        <button onclick="resetGame()" class="bg-purple-500 hover:bg-purple-600 text-white text-xl px-8 py-3 rounded-full font-bold transition-all">
            Jogar Novamente
        </button>
    </div>

    <script>
        // Configura√ß√£o do Dark Mode
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        let userBet = null;
        let entities = [];
        let gameRunning = false;
        let animationId = null;

        // Configura√ß√£o do canvas
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // Classe para cada entidade
        class Entity {
            constructor(type, x, y) {
                this.type = type; // 'rock', 'paper', 'scissors'
                this.x = x;
                this.y = y;
                this.size = 30;
                // Velocidades mais lentas
                this.vx = (Math.random() - 0.5) * 1.5;
                this.vy = (Math.random() - 0.5) * 1.5;
                this.alive = true;
                this.battleCooldown = 0; // Evitar m√∫ltiplas batalhas simult√¢neas
            }

            getEmoji() {
                switch(this.type) {
                    case 'rock': return 'ü™®';
                    case 'paper': return 'üìÉ';
                    case 'scissors': return '‚úÇÔ∏è';
                }
            }

            update() {
                if (!this.alive) return;

                this.x += this.vx;
                this.y += this.vy;

                // Reduzir cooldown
                if (this.battleCooldown > 0) {
                    this.battleCooldown--;
                }

                // Colis√£o com bordas
                if (this.x <= this.size || this.x >= canvas.width - this.size) {
                    this.vx *= -1;
                    this.x = Math.max(this.size, Math.min(canvas.width - this.size, this.x));
                }
                if (this.y <= this.size || this.y >= canvas.height - this.size) {
                    this.vy *= -1;
                    this.y = Math.max(this.size, Math.min(canvas.height - this.size, this.y));
                }
            }

            draw() {
                if (!this.alive) return;

                ctx.font = `${this.size * 1.5}px Arial`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(this.getEmoji(), this.x, this.y);
            }

            checkCollision(other) {
                if (!this.alive || !other.alive || this.type === other.type) return;

                // Verificar se ambos podem batalhar (n√£o est√£o em cooldown)
                if (this.battleCooldown > 0 || other.battleCooldown > 0) return;

                const dx = this.x - other.x;
                const dy = this.y - other.y;
                const distance = Math.sqrt(dx * dx + dy * dy);

                if (distance < this.size + other.size) {
                    this.battle(other);
                }
            }

            battle(other) {
                const wins = {
                    'rock': 'scissors',
                    'paper': 'rock',
                    'scissors': 'paper'
                };

                if (wins[this.type] === other.type) {
                    // Este vence, o outro se transforma
                    other.type = this.type;
                    this.createParticles(other.x, other.y);
                    // Adicionar cooldown para ambos
                    this.battleCooldown = 30;
                    other.battleCooldown = 30;
                } else if (wins[other.type] === this.type) {
                    // O outro vence, este se transforma
                    this.type = other.type;
                    this.createParticles(this.x, this.y);
                    // Adicionar cooldown para ambos
                    this.battleCooldown = 30;
                    other.battleCooldown = 30;
                }
            }

            createParticles(x, y) {
                // Efeito visual de explos√£o
                ctx.save();
                ctx.globalAlpha = 0.5;
                ctx.fillStyle = '#ff6b6b';
                ctx.beginPath();
                ctx.arc(x, y, 20, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
            }
        }

        function selectBet(type) {
            userBet = type;

            // Remove sele√ß√£o anterior
            document.querySelectorAll('.emoji-button').forEach(btn => {
                btn.classList.remove('selected');
            });

            // Adiciona sele√ß√£o ao bot√£o clicado
            document.getElementById(`btn-${type}`).classList.add('selected');

            // Habilita bot√£o de iniciar
            document.getElementById('startBtn').disabled = false;
        }

        function startGame() {
            document.getElementById('selectionScreen').style.display = 'none';
            document.getElementById('scoreboard').style.display = 'flex';

            // Criar entidades - EXATAMENTE 20 de cada tipo
            entities = [];
            const types = ['rock', 'paper', 'scissors'];

            // Dividir a tela em 3 √°reas: esquerda, topo direito, baixo direito
            types.forEach((type, index) => {
                for (let i = 0; i < 20; i++) {
                    let x, y;
                    const margin = 30;

                    if (index === 0) {
                        // PEDRA - Lado ESQUERDO
                        x = margin + Math.random() * (canvas.width * 0.2);
                        y = margin + Math.random() * (canvas.height - 2 * margin);
                    } else if (index === 1) {
                        // PAPEL - Lado DIREITO SUPERIOR
                        x = canvas.width * 0.7 + Math.random() * (canvas.width * 0.25);
                        y = margin + Math.random() * (canvas.height * 0.4);
                    } else {
                        // TESOURA - Lado DIREITO INFERIOR
                        x = canvas.width * 0.7 + Math.random() * (canvas.width * 0.25);
                        y = canvas.height * 0.6 + Math.random() * (canvas.height * 0.35);
                    }

                    entities.push(new Entity(type, x, y));
                }
            });

            gameRunning = true;
            gameLoop();
        }

        function gameLoop() {
            if (!gameRunning) return;

            // Limpar canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Desenhar fundo gradiente
            const isDark = document.documentElement.classList.contains('dark');
            const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
            if (isDark) {
                gradient.addColorStop(0, '#1a1a2e');
                gradient.addColorStop(1, '#16213e');
            } else {
                gradient.addColorStop(0, '#667eea');
                gradient.addColorStop(1, '#764ba2');
            }
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Atualizar e desenhar entidades
            entities.forEach(entity => entity.update());
            entities.forEach(entity => entity.draw());

            // Verificar colis√µes
            for (let i = 0; i < entities.length; i++) {
                for (let j = i + 1; j < entities.length; j++) {
                    entities[i].checkCollision(entities[j]);
                }
            }

            // Atualizar placar
            updateScoreboard();

            // Verificar fim do jogo
            checkGameEnd();

            animationId = requestAnimationFrame(gameLoop);
        }

        function updateScoreboard() {
            const counts = {
                rock: 0,
                paper: 0,
                scissors: 0
            };

            entities.forEach(entity => {
                counts[entity.type]++;
            });

            document.getElementById('rockCount').textContent = counts.rock;
            document.getElementById('paperCount').textContent = counts.paper;
            document.getElementById('scissorsCount').textContent = counts.scissors;
        }

        function checkGameEnd() {
            const types = new Set(entities.map(e => e.type));

            if (types.size === 1 && entities.length > 0) {
                gameRunning = false;
                const winner = entities[0].type;
                showResult(winner);
            } else if (entities.length === 0) {
                gameRunning = false;
                showResult(null);
            }
        }

        function showResult(winner) {
            const banner = document.getElementById('resultBanner');
            const title = document.getElementById('resultTitle');
            const text = document.getElementById('resultText');

            const emojis = {
                rock: 'ü™®',
                paper: 'üìÉ',
                scissors: '‚úÇÔ∏è'
            };

            if (winner === null) {
                title.textContent = 'üòÆ Empate!';
                text.textContent = 'Ningu√©m sobreviveu!';
                title.className = 'text-3xl md:text-5xl font-bold mb-4 text-gray-700 dark:text-gray-300';
            } else if (winner === userBet) {
                title.textContent = `üéâ Voc√™ Ganhou! ${emojis[winner]}`;
                text.textContent = `${emojis[winner]} venceu a batalha!`;
                title.className = 'text-3xl md:text-5xl font-bold mb-4 text-green-600 dark:text-green-400';
            } else {
                title.textContent = `üò¢ Voc√™ Perdeu! ${emojis[winner]}`;
                text.textContent = `${emojis[winner]} venceu a batalha!`;
                title.className = 'text-3xl md:text-5xl font-bold mb-4 text-red-600 dark:text-red-400';
            }

            banner.style.display = 'block';
            banner.classList.add('result-banner');
        }

        function resetGame() {
            // Cancelar anima√ß√£o
            if (animationId) {
                cancelAnimationFrame(animationId);
            }

            // Reset vari√°veis
            entities = [];
            gameRunning = false;
            userBet = null;

            // Esconder elementos
            document.getElementById('resultBanner').style.display = 'none';
            document.getElementById('scoreboard').style.display = 'none';

            // Mostrar tela de sele√ß√£o
            document.getElementById('selectionScreen').style.display = 'flex';

            // Reset bot√µes
            document.querySelectorAll('.emoji-button').forEach(btn => {
                btn.classList.remove('selected');
            });
            document.getElementById('startBtn').disabled = true;

            // Limpar canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }
    </script>
</body>
</html>